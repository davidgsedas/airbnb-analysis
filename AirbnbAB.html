<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.547">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Gómez Sedas">

<title>Airbnb - Revenue Management</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="AirbnbAB_files/libs/clipboard/clipboard.min.js"></script>
<script src="AirbnbAB_files/libs/quarto-html/quarto.js"></script>
<script src="AirbnbAB_files/libs/quarto-html/popper.min.js"></script>
<script src="AirbnbAB_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="AirbnbAB_files/libs/quarto-html/anchor.min.js"></script>
<link href="AirbnbAB_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="AirbnbAB_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="AirbnbAB_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="AirbnbAB_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="AirbnbAB_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Airbnb - Revenue Management</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Gómez Sedas </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>A continuación se enumeran todas las librerías utilizadas en el AB:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──
✔ broom        1.0.5     ✔ rsample      1.2.0
✔ dials        1.2.0     ✔ tune         1.1.2
✔ infer        1.0.5     ✔ workflows    1.1.3
✔ modeldata    1.3.0     ✔ workflowsets 1.0.1
✔ parsnip      1.1.1     ✔ yardstick    1.3.0
✔ recipes      1.0.9     
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()
• Use suppressPackageStartupMessages() to eliminate package startup messages</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quarto)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastDummies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Thank you for using fastDummies!
To acknowledge our work, please cite the package:
Kaplan, J. &amp; Schlegel, B. (2023). fastDummies: Fast Creation of Dummy (Binary) Columns and Rows from Categorical Variables. Version 1.7.1. URL: https://github.com/jacobkap/fastDummies, https://jacobkap.github.io/fastDummies/.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
</div>
</div>
<section id="datos-usados" class="level1">
<h1>Datos usados</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"listings_bcn.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="origen-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="origen-de-los-datos">Origen de los datos</h2>
<p>Los datos han sido extraidos de “Inside Airbnb”, el cual es un proyecto que provee datos e información sobre el impacto que tiene Airbnb sobre las comunidades residenciales.</p>
<p>La finalidad de este proyecto es trabajar en torno a una visión que consiste en informar a estas comunidades sobre el uso real de airbnb.</p>
<p>Los datos son extraidos de la web de Airbnb oficial y son almacenados en archivos compatibles con datos tabulares para distribuirlos. Podemos encontrar que los datos están separados por ciudades y estos se suelen actualizar frecuentemente para mostrar una imagen lo mas actual posible.</p>
<p>Todos los datos de la web estan licenciados bajo Creative Commons Attribution 4.0 International License.</p>
<p>Concretamente, los datos utilizados en este trabajo consisten en todas las residencias activas en Airbnb de la ciudad de Barcelona. En ellas podemos encontar diferentes tipos de servicios: Apartamentos, casas, habitaciones y camas en habitaciones compartidas.</p>
</section>
<section id="contenido" class="level2">
<h2 class="anchored" data-anchor-id="contenido">Contenido</h2>
<p>Los datos utilizados consisten en unos datos tabulares los cuales consisten en 18086 entradas y 75 columnas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [18,086 × 75] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ id                                          : num [1:18086] 18674 23197 117010 32711 118228 ...
 $ listing_url                                 : chr [1:18086] "https://www.airbnb.com/rooms/18674" "https://www.airbnb.com/rooms/23197" "https://www.airbnb.com/rooms/117010" "https://www.airbnb.com/rooms/32711" ...
 $ scrape_id                                   : num [1:18086] 2.02e+13 2.02e+13 2.02e+13 2.02e+13 2.02e+13 ...
 $ last_scraped                                : Date[1:18086], format: "2023-09-06" "2023-09-06" ...
 $ source                                      : chr [1:18086] "city scrape" "city scrape" "previous scrape" "city scrape" ...
 $ name                                        : chr [1:18086] "Rental unit in Barcelona · ★4.30 · 3 bedrooms · 6 beds · 2 baths" "Rental unit in Sant Adria de Besos · ★4.77 · 3 bedrooms · 4 beds · 2 baths" "Rental unit in Barcelona · ★4.55 · 3 bedrooms · 6 beds · 2 baths" "Rental unit in Barcelona · ★4.46 · 2 bedrooms · 3 beds · 1.5 baths" ...
 $ description                                 : chr [1:18086] "110m2 apartment to rent in Barcelona. Located in the Eixample district, near the Sagrada Familia. It has a smal"| __truncated__ "Beautiful spacious apartment, large terrace, 5 minutes walk from the CCIB center, sea, Port Forum.&lt;br /&gt;Excelle"| __truncated__ "Have an authentic Barcelona experience! Modern 100m2 recently decorated apartment - definitely one to consider "| __truncated__ "A lovely two bedroom apartment only 250 m from Barcelona's iconic Sagrada Familia.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;The space&lt;/b&gt;&lt;"| __truncated__ ...
 $ neighborhood_overview                       : chr [1:18086] "Apartment in Barcelona located in the heart of Eixample district, within only 150 m form the great Sagrada Fami"| __truncated__ "Strategically located in the Parc del Fòrum, a spacious area where all kinds of music festivals and events are "| __truncated__ "Apartment is located just 240 meters from Sagrada Familia. Right on Avenida Gaudí, a cozy boulevard that leads "| __truncated__ "What's nearby  &lt;br /&gt;This apartment is located in central Barcelona only 250m from the famous Sagrada Familia. "| __truncated__ ...
 $ picture_url                                 : chr [1:18086] "https://a0.muscache.com/pictures/13031453/413cdbfc_original.jpg" "https://a0.muscache.com/pictures/miso/Hosting-23197/original/0820d261-5f12-4ac9-8604-fefa1c5ec62a.jpeg" "https://a0.muscache.com/pictures/4052d8b5-7352-41be-821d-4188eb99a89a.jpg" "https://a0.muscache.com/pictures/357b25e4-f414-48c5-aad0-e89342b1daa2.jpg" ...
 $ host_id                                     : num [1:18086] 71615 90417 567180 135703 567180 ...
 $ host_url                                    : chr [1:18086] "https://www.airbnb.com/users/show/71615" "https://www.airbnb.com/users/show/90417" "https://www.airbnb.com/users/show/567180" "https://www.airbnb.com/users/show/135703" ...
 $ host_name                                   : chr [1:18086] "Mireia And Maria" "Etain (Marnie)" "Sandra" "Nick" ...
 $ host_since                                  : Date[1:18086], format: "2010-01-19" "2010-03-09" ...
 $ host_location                               : chr [1:18086] "Barcelona, Spain" "Catalonia, Spain" "Barcelona, Spain" "Barcelona, Spain" ...
 $ host_about                                  : chr [1:18086] "We are Mireia (47) &amp; Maria (49), two multilingual entrepreneurs loving Barcelona and having big experience in t"| __truncated__ "Hi there, I'm marnie from Australia, though I have been living in Spain for many years.\nMy lovely co-host, Jak"| __truncated__ "Suite Home Sagrada Familia is a complex of apartments with 12 years of experience. \"Welcome to your home” is o"| __truncated__ "I'm Nick your English host in Barcelona.\r\n\r\nI'm a full time host with several holiday rental apartments tha"| __truncated__ ...
 $ host_response_time                          : chr [1:18086] "within an hour" "within an hour" "within a few hours" "within an hour" ...
 $ host_response_rate                          : chr [1:18086] "97%" "100%" "88%" "100%" ...
 $ host_acceptance_rate                        : chr [1:18086] "90%" "94%" "98%" "100%" ...
 $ host_is_superhost                           : logi [1:18086] FALSE TRUE FALSE FALSE FALSE FALSE ...
 $ host_thumbnail_url                          : chr [1:18086] "https://a0.muscache.com/im/users/71615/profile_pic/1426612511/original.jpg?aki_policy=profile_small" "https://a0.muscache.com/im/pictures/user/44b56b17-e3c1-4fc9-a036-09edc5a0bbee.jpg?aki_policy=profile_small" "https://a0.muscache.com/im/pictures/user/7aaeb41d-1ee2-48cb-927a-c39c0868eb7d.jpg?aki_policy=profile_small" "https://a0.muscache.com/im/users/135703/profile_pic/1346864531/original.jpg?aki_policy=profile_small" ...
 $ host_picture_url                            : chr [1:18086] "https://a0.muscache.com/im/users/71615/profile_pic/1426612511/original.jpg?aki_policy=profile_x_medium" "https://a0.muscache.com/im/pictures/user/44b56b17-e3c1-4fc9-a036-09edc5a0bbee.jpg?aki_policy=profile_x_medium" "https://a0.muscache.com/im/pictures/user/7aaeb41d-1ee2-48cb-927a-c39c0868eb7d.jpg?aki_policy=profile_x_medium" "https://a0.muscache.com/im/users/135703/profile_pic/1346864531/original.jpg?aki_policy=profile_x_medium" ...
 $ host_neighbourhood                          : chr [1:18086] "la Sagrada Família" "El Besòs i el Maresme" "la Sagrada Familia" "Camp d'en Grassot i Gràcia Nova" ...
 $ host_listings_count                         : num [1:18086] 47 6 19 3 19 1 34 3 34 2 ...
 $ host_total_listings_count                   : num [1:18086] 48 9 19 15 19 1 50 4 50 2 ...
 $ host_verifications                          : chr [1:18086] "['email', 'phone']" "['email', 'phone']" "['email', 'phone']" "['email', 'phone', 'work_email']" ...
 $ host_has_profile_pic                        : logi [1:18086] TRUE TRUE TRUE TRUE TRUE TRUE ...
 $ host_identity_verified                      : logi [1:18086] TRUE TRUE FALSE TRUE FALSE TRUE ...
 $ neighbourhood                               : chr [1:18086] "Barcelona, CT, Spain" "Sant Adria de Besos, Barcelona, Spain" "Barcelona, Catalonia, Spain" "Barcelona, Catalonia, Spain" ...
 $ neighbourhood_cleansed                      : chr [1:18086] "la Sagrada Família" "el Besòs i el Maresme" "la Sagrada Família" "el Camp d'en Grassot i Gràcia Nova" ...
 $ neighbourhood_group_cleansed                : chr [1:18086] "Eixample" "Sant Martí" "Eixample" "Gràcia" ...
 $ latitude                                    : num [1:18086] 41.4 41.4 41.4 41.4 41.4 ...
 $ longitude                                   : num [1:18086] 2.17 2.22 2.17 2.17 2.17 ...
 $ property_type                               : chr [1:18086] "Entire rental unit" "Entire rental unit" "Entire rental unit" "Entire rental unit" ...
 $ room_type                                   : chr [1:18086] "Entire home/apt" "Entire home/apt" "Entire home/apt" "Entire home/apt" ...
 $ accommodates                                : num [1:18086] 8 5 8 6 8 2 7 9 7 5 ...
 $ bathrooms                                   : logi [1:18086] NA NA NA NA NA NA ...
 $ bathrooms_text                              : chr [1:18086] "2 baths" "2 baths" "2 baths" "1.5 baths" ...
 $ bedrooms                                    : num [1:18086] 3 3 3 2 3 1 3 4 3 2 ...
 $ beds                                        : num [1:18086] 6 4 6 3 5 1 5 6 4 3 ...
 $ amenities                                   : chr [1:18086] "[\"Refrigerator\", \"30\\\" TV\", \"Iron\", \"Hangers\", \"City skyline view\", \"Free washer \\u2013 In unit\""| __truncated__ "[\"Refrigerator\", \"Toaster\", \"Cleaning products\", \"Room-darkening shades\", \"Fire extinguisher\", \"Publ"| __truncated__ "[\"Refrigerator\", \"Clothing storage: closet and dresser\", \"Toaster\", \"Room-darkening shades\", \"Fire ext"| __truncated__ "[\"Refrigerator\", \"Fire extinguisher\", \"First aid kit\", \"Iron\", \"Hangers\", \"Paid parking off premises"| __truncated__ ...
 $ price                                       : chr [1:18086] "$202.00" "$255.00" "$331.00" "$171.00" ...
 $ minimum_nights                              : num [1:18086] 1 3 2 21 2 3 3 5 3 90 ...
 $ maximum_nights                              : num [1:18086] 1125 300 30 31 28 ...
 $ minimum_minimum_nights                      : num [1:18086] 1 3 2 1 2 3 2 2 3 90 ...
 $ maximum_minimum_nights                      : num [1:18086] 4 5 3 1 3 3 6 5 6 90 ...
 $ minimum_maximum_nights                      : num [1:18086] 1125 1125 30 31 28 ...
 $ maximum_maximum_nights                      : num [1:18086] 1125 1125 32 31 32 ...
 $ minimum_nights_avg_ntm                      : num [1:18086] 2.2 3.2 2 1 2.1 3 3.3 4.9 3.3 90 ...
 $ maximum_nights_avg_ntm                      : num [1:18086] 1125 1125 30.3 31 28.7 ...
 $ calendar_updated                            : logi [1:18086] NA NA NA NA NA NA ...
 $ has_availability                            : logi [1:18086] TRUE TRUE FALSE TRUE FALSE TRUE ...
 $ availability_30                             : num [1:18086] 4 16 0 6 0 2 7 5 6 30 ...
 $ availability_60                             : num [1:18086] 11 31 0 17 0 9 18 20 12 60 ...
 $ availability_90                             : num [1:18086] 21 61 0 43 0 32 18 38 31 90 ...
 $ availability_365                            : num [1:18086] 34 150 0 310 0 303 266 194 279 365 ...
 $ calendar_last_scraped                       : Date[1:18086], format: "2023-09-06" "2023-09-06" ...
 $ number_of_reviews                           : num [1:18086] 38 73 48 95 50 395 32 211 85 131 ...
 $ number_of_reviews_ltm                       : num [1:18086] 8 11 6 21 18 62 14 31 33 0 ...
 $ number_of_reviews_l30d                      : num [1:18086] 0 1 1 1 0 6 1 2 1 0 ...
 $ first_review                                : Date[1:18086], format: "2013-05-27" "2011-03-15" ...
 $ last_review                                 : Date[1:18086], format: "2023-06-26" "2023-08-15" ...
 $ review_scores_rating                        : num [1:18086] 4.3 4.77 4.55 4.46 4.56 4.86 4.56 4.53 4.43 4.64 ...
 $ review_scores_accuracy                      : num [1:18086] 4.41 4.93 4.59 4.44 4.5 4.9 4.81 4.61 4.64 4.74 ...
 $ review_scores_cleanliness                   : num [1:18086] 4.62 4.89 4.57 4.47 4.62 4.93 4.75 4.62 4.48 4.68 ...
 $ review_scores_checkin                       : num [1:18086] 4.76 4.94 4.82 4.86 4.56 4.93 4.84 4.68 4.79 4.69 ...
 $ review_scores_communication                 : num [1:18086] 4.65 4.99 4.91 4.85 4.74 4.9 4.78 4.69 4.81 4.8 ...
 $ review_scores_location                      : num [1:18086] 4.78 4.6 4.86 4.86 4.9 4.72 4.81 4.69 4.88 4.83 ...
 $ review_scores_value                         : num [1:18086] 4.27 4.64 4.59 4.52 4.52 4.82 4.38 4.43 4.32 4.56 ...
 $ license                                     : chr [1:18086] "HUTB-002062" "HUTB005057" "HUTB000331" "HUTB-001722" ...
 $ instant_bookable                            : logi [1:18086] TRUE FALSE FALSE TRUE FALSE FALSE ...
 $ calculated_host_listings_count              : num [1:18086] 30 2 19 3 19 1 32 2 32 2 ...
 $ calculated_host_listings_count_entire_homes : num [1:18086] 30 2 19 3 19 1 32 2 32 2 ...
 $ calculated_host_listings_count_private_rooms: num [1:18086] 0 0 0 0 0 0 0 0 0 0 ...
 $ calculated_host_listings_count_shared_rooms : num [1:18086] 0 0 0 0 0 0 0 0 0 0 ...
 $ reviews_per_month                           : num [1:18086] 0.3 0.48 0.33 0.64 0.34 2.7 0.28 1.34 0.67 0.9 ...
 - attr(*, "spec")=
  .. cols(
  ..   id = col_double(),
  ..   listing_url = col_character(),
  ..   scrape_id = col_double(),
  ..   last_scraped = col_date(format = ""),
  ..   source = col_character(),
  ..   name = col_character(),
  ..   description = col_character(),
  ..   neighborhood_overview = col_character(),
  ..   picture_url = col_character(),
  ..   host_id = col_double(),
  ..   host_url = col_character(),
  ..   host_name = col_character(),
  ..   host_since = col_date(format = ""),
  ..   host_location = col_character(),
  ..   host_about = col_character(),
  ..   host_response_time = col_character(),
  ..   host_response_rate = col_character(),
  ..   host_acceptance_rate = col_character(),
  ..   host_is_superhost = col_logical(),
  ..   host_thumbnail_url = col_character(),
  ..   host_picture_url = col_character(),
  ..   host_neighbourhood = col_character(),
  ..   host_listings_count = col_double(),
  ..   host_total_listings_count = col_double(),
  ..   host_verifications = col_character(),
  ..   host_has_profile_pic = col_logical(),
  ..   host_identity_verified = col_logical(),
  ..   neighbourhood = col_character(),
  ..   neighbourhood_cleansed = col_character(),
  ..   neighbourhood_group_cleansed = col_character(),
  ..   latitude = col_double(),
  ..   longitude = col_double(),
  ..   property_type = col_character(),
  ..   room_type = col_character(),
  ..   accommodates = col_double(),
  ..   bathrooms = col_logical(),
  ..   bathrooms_text = col_character(),
  ..   bedrooms = col_double(),
  ..   beds = col_double(),
  ..   amenities = col_character(),
  ..   price = col_character(),
  ..   minimum_nights = col_double(),
  ..   maximum_nights = col_double(),
  ..   minimum_minimum_nights = col_double(),
  ..   maximum_minimum_nights = col_double(),
  ..   minimum_maximum_nights = col_double(),
  ..   maximum_maximum_nights = col_double(),
  ..   minimum_nights_avg_ntm = col_double(),
  ..   maximum_nights_avg_ntm = col_double(),
  ..   calendar_updated = col_logical(),
  ..   has_availability = col_logical(),
  ..   availability_30 = col_double(),
  ..   availability_60 = col_double(),
  ..   availability_90 = col_double(),
  ..   availability_365 = col_double(),
  ..   calendar_last_scraped = col_date(format = ""),
  ..   number_of_reviews = col_double(),
  ..   number_of_reviews_ltm = col_double(),
  ..   number_of_reviews_l30d = col_double(),
  ..   first_review = col_date(format = ""),
  ..   last_review = col_date(format = ""),
  ..   review_scores_rating = col_double(),
  ..   review_scores_accuracy = col_double(),
  ..   review_scores_cleanliness = col_double(),
  ..   review_scores_checkin = col_double(),
  ..   review_scores_communication = col_double(),
  ..   review_scores_location = col_double(),
  ..   review_scores_value = col_double(),
  ..   license = col_character(),
  ..   instant_bookable = col_logical(),
  ..   calculated_host_listings_count = col_double(),
  ..   calculated_host_listings_count_entire_homes = col_double(),
  ..   calculated_host_listings_count_private_rooms = col_double(),
  ..   calculated_host_listings_count_shared_rooms = col_double(),
  ..   reviews_per_month = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>En el archivo encontramos cuatro tipos de datos distintos:</p>
<ul>
<li><p>double</p></li>
<li><p>character</p></li>
<li><p>logical</p></li>
<li><p>date</p></li>
</ul>
<p>Los datos nos hablan de todos los apartados relacionados con el alojamiento ofrecido, la información del host, el precio medio, la disponibilidad, imagenes de los alojamientos e información de las reseñas.</p>
</section>
<section id="definición-de-variables" class="level2">
<h2 class="anchored" data-anchor-id="definición-de-variables">Definición de variables</h2>
<p>Vamos a definir las variables que contienen los datos</p>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<tbody>
<tr class="odd">
<td>id</td>
<td>Identificador único del alojamiento en Airbnb</td>
</tr>
<tr class="even">
<td>listing_url</td>
<td>Link al portal del alojamiento</td>
</tr>
<tr class="odd">
<td>scrape_id</td>
<td>Identificador de scrapping de los datos</td>
</tr>
<tr class="even">
<td>last_scraped</td>
<td>Hora del scrapping</td>
</tr>
<tr class="odd">
<td>source</td>
<td>Fuente, de la entrada, si es reciente o antigua.</td>
</tr>
<tr class="even">
<td>name</td>
<td>Nombre del alojamiento</td>
</tr>
<tr class="odd">
<td>description</td>
<td>Descripción del alojamiento</td>
</tr>
<tr class="even">
<td>neighborhood_overview</td>
<td>Descripción del barrio del host</td>
</tr>
<tr class="odd">
<td>picture_url</td>
<td>Link de las fotografías del alojamiento</td>
</tr>
<tr class="even">
<td>host_id</td>
<td>Identificador del host del alojamiento</td>
</tr>
<tr class="odd">
<td>host_url</td>
<td>Link al portal del perfil del host</td>
</tr>
<tr class="even">
<td>host_name</td>
<td>Nombre del host</td>
</tr>
<tr class="odd">
<td>host_since</td>
<td>Fecha de registro como host</td>
</tr>
<tr class="even">
<td>host_location</td>
<td>Localización del host</td>
</tr>
<tr class="odd">
<td>host_about</td>
<td>Descripción del host sobre si mismo.</td>
</tr>
<tr class="even">
<td>host_response_time</td>
<td>Tiempo promedio de respuesta del host</td>
</tr>
<tr class="odd">
<td>host_response_rate</td>
<td>Porcentaje de respuestas realizadas por el host.</td>
</tr>
<tr class="even">
<td>host_acceptance_rate</td>
<td>Porcentaje de solicitudes de alojamiento aceptadas por el host.</td>
</tr>
<tr class="odd">
<td>host_is_superhost</td>
<td>Estatus otorgado por Airbnb por ser un host con ciertas características positivas según la plataforma</td>
</tr>
<tr class="even">
<td>host_picture_url</td>
<td>Link de la foto de perfil del host</td>
</tr>
<tr class="odd">
<td>host_neighbourhood</td>
<td>Barrio donde reside el host</td>
</tr>
<tr class="even">
<td>host_listings_count</td>
<td>Número de alojamientos listados por el host (cuenta manual)</td>
</tr>
<tr class="odd">
<td>host_total_listings_count</td>
<td>Número de alojamientos listados por el host (cuenta segun Airbnb)</td>
</tr>
<tr class="even">
<td>host_verifications</td>
<td>Métodos por los cuales el host se ha verificado</td>
</tr>
<tr class="odd">
<td>host_has_profile_pic</td>
<td>Boolean que indica si el host se ha verificado</td>
</tr>
<tr class="even">
<td>host_identity_verified</td>
<td>Boolean que indica si la identidad se ha verificado</td>
</tr>
<tr class="odd">
<td>neighbourhood_group_cleansed</td>
<td>Barrio según coordenadas.</td>
</tr>
<tr class="even">
<td>latitude</td>
<td>Coordenada de latitud del alojamiento</td>
</tr>
<tr class="odd">
<td>longitude</td>
<td>Coordenada de longitud del alojamiento</td>
</tr>
<tr class="even">
<td>property_type</td>
<td>Tipo de propiedad del alojamiento</td>
</tr>
<tr class="odd">
<td>room_type</td>
<td>Tipo de habitación, si es compartida o individual.</td>
</tr>
<tr class="even">
<td>accommodates</td>
<td>Capacidad de personas</td>
</tr>
<tr class="odd">
<td>bathrooms</td>
<td>Número de banos</td>
</tr>
<tr class="even">
<td>bedrooms</td>
<td>Número de dormitorios</td>
</tr>
<tr class="odd">
<td>beds</td>
<td>Número de camas</td>
</tr>
<tr class="even">
<td>price</td>
<td>Precio diario para alojarse</td>
</tr>
<tr class="odd">
<td>minimum_nights</td>
<td>Noches mínimas que hay alojarse para reservar</td>
</tr>
<tr class="even">
<td>maximum_nights</td>
<td>Noches máximas que se pueden reservar</td>
</tr>
<tr class="odd">
<td>has_availability</td>
<td>Indica si hay disponibilidad.</td>
</tr>
<tr class="even">
<td>availability_30</td>
<td>Disponibilidad en los proximos 30 dias.</td>
</tr>
<tr class="odd">
<td>availability_60</td>
<td>Disponibilidad en los proximos 60 dias.</td>
</tr>
<tr class="even">
<td>availability_90</td>
<td>Disponibilidad en los proximos 90 dias.</td>
</tr>
<tr class="odd">
<td>availability_365</td>
<td>Disponibilidad en los proximos 365 dias.</td>
</tr>
<tr class="even">
<td>number_of_reviews</td>
<td>Número de reviews que ha recibido el alojamiento.</td>
</tr>
<tr class="odd">
<td>number_of_reviews_ltm</td>
<td>Número de reviews que ha recibido el alojamiento en los últimos 12 meses.</td>
</tr>
<tr class="even">
<td>number_of_reviews_l30d</td>
<td>Número de reviews que ha recibido el alojamiento en los últimos 30 dias.</td>
</tr>
<tr class="odd">
<td>first_review</td>
<td>Fecha de la primera review del alojamiento.</td>
</tr>
<tr class="even">
<td>last_review</td>
<td>Fecha de la última review del alojamiento</td>
</tr>
<tr class="odd">
<td>review_scores_rating</td>
<td>Nota media de las reviews en general</td>
</tr>
<tr class="even">
<td>review_scores_accuracy</td>
<td>Nota media de las reviews en precisión</td>
</tr>
<tr class="odd">
<td>review_scores_cleanliness</td>
<td>Nota media de las reviews en limpieza</td>
</tr>
<tr class="even">
<td>review_scores_checkin</td>
<td>Nota media de las reviews en el proceso de checkin</td>
</tr>
<tr class="odd">
<td>review_scores_communication</td>
<td>Nota media de las reviews en comunicación</td>
</tr>
<tr class="even">
<td>review_scores_location</td>
<td>Nota media de las reviews en localización</td>
</tr>
<tr class="odd">
<td>review_scores_value</td>
<td>Nota media de las reviews en valor (calidad / precio)</td>
</tr>
<tr class="even">
<td>license</td>
<td>Licencia del alojamiento</td>
</tr>
<tr class="odd">
<td>instant_bookable</td>
<td>Indica si el alojamiento se reserva automáticamente o se necesita la aprobación del host.</td>
</tr>
</tbody>
</table>
</section>
<section id="muestra-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="muestra-de-los-datos">Muestra de los datos</h2>
<p>A continuación, una muestra de los datos obtenidos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 75
      id listing_url             scrape_id last_scraped source name  description
   &lt;dbl&gt; &lt;chr&gt;                       &lt;dbl&gt; &lt;date&gt;       &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      
1  18674 https://www.airbnb.com…   2.02e13 2023-09-06   city … Rent… 110m2 apar…
2  23197 https://www.airbnb.com…   2.02e13 2023-09-06   city … Rent… Beautiful …
3 117010 https://www.airbnb.com…   2.02e13 2023-09-06   previ… Rent… Have an au…
4  32711 https://www.airbnb.com…   2.02e13 2023-09-06   city … Rent… A lovely t…
5 118228 https://www.airbnb.com…   2.02e13 2023-09-06   previ… Rent… Modern 100…
6 128463 https://www.airbnb.com…   2.02e13 2023-09-06   city … Rent… My House i…
# ℹ 68 more variables: neighborhood_overview &lt;chr&gt;, picture_url &lt;chr&gt;,
#   host_id &lt;dbl&gt;, host_url &lt;chr&gt;, host_name &lt;chr&gt;, host_since &lt;date&gt;,
#   host_location &lt;chr&gt;, host_about &lt;chr&gt;, host_response_time &lt;chr&gt;,
#   host_response_rate &lt;chr&gt;, host_acceptance_rate &lt;chr&gt;,
#   host_is_superhost &lt;lgl&gt;, host_thumbnail_url &lt;chr&gt;, host_picture_url &lt;chr&gt;,
#   host_neighbourhood &lt;chr&gt;, host_listings_count &lt;dbl&gt;,
#   host_total_listings_count &lt;dbl&gt;, host_verifications &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>Vamos a ver un análisis rápido de los datos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id            listing_url          scrape_id        
 Min.   :1.867e+04   Length:18086       Min.   :2.023e+13  
 1st Qu.:2.172e+07   Class :character   1st Qu.:2.023e+13  
 Median :4.435e+07   Mode  :character   Median :2.023e+13  
 Mean   :2.997e+17                      Mean   :2.023e+13  
 3rd Qu.:7.450e+17                      3rd Qu.:2.023e+13  
 Max.   :9.740e+17                      Max.   :2.023e+13  
                                                           
  last_scraped           source              name           description       
 Min.   :2023-09-06   Length:18086       Length:18086       Length:18086      
 1st Qu.:2023-09-06   Class :character   Class :character   Class :character  
 Median :2023-09-06   Mode  :character   Mode  :character   Mode  :character  
 Mean   :2023-09-06                                                           
 3rd Qu.:2023-09-06                                                           
 Max.   :2023-09-06                                                           
                                                                              
 neighborhood_overview picture_url           host_id         
 Length:18086          Length:18086       Min.   :     3073  
 Class :character      Class :character   1st Qu.:  9919300  
 Mode  :character      Mode  :character   Median : 96299106  
                                          Mean   :166184865  
                                          3rd Qu.:310348791  
                                          Max.   :535400790  
                                                             
   host_url          host_name           host_since         host_location     
 Length:18086       Length:18086       Min.   :2008-09-19   Length:18086      
 Class :character   Class :character   1st Qu.:2013-11-10   Class :character  
 Mode  :character   Mode  :character   Median :2016-09-22   Mode  :character  
                                       Mean   :2016-12-27                     
                                       3rd Qu.:2019-11-18                     
                                       Max.   :2023-09-04                     
                                       NA's   :2                              
  host_about        host_response_time host_response_rate host_acceptance_rate
 Length:18086       Length:18086       Length:18086       Length:18086        
 Class :character   Class :character   Class :character   Class :character    
 Mode  :character   Mode  :character   Mode  :character   Mode  :character    
                                                                              
                                                                              
                                                                              
                                                                              
 host_is_superhost host_thumbnail_url host_picture_url   host_neighbourhood
 Mode :logical     Length:18086       Length:18086       Length:18086      
 FALSE:14580       Class :character   Class :character   Class :character  
 TRUE :3087        Mode  :character   Mode  :character   Mode  :character  
 NA's :419                                                                 
                                                                           
                                                                           
                                                                           
 host_listings_count host_total_listings_count host_verifications
 Min.   :  1.00      Min.   :   1.00           Length:18086      
 1st Qu.:  2.00      1st Qu.:   2.00           Class :character  
 Median :  6.00      Median :   9.00           Mode  :character  
 Mean   : 41.13      Mean   :  53.55                             
 3rd Qu.: 34.00      3rd Qu.:  48.00                             
 Max.   :786.00      Max.   :1853.00                             
 NA's   :2           NA's   :2                                   
 host_has_profile_pic host_identity_verified neighbourhood     
 Mode :logical        Mode :logical          Length:18086      
 FALSE:330            FALSE:1471             Class :character  
 TRUE :17754          TRUE :16613            Mode  :character  
 NA's :2              NA's :2                                  
                                                               
                                                               
                                                               
 neighbourhood_cleansed neighbourhood_group_cleansed    latitude    
 Length:18086           Length:18086                 Min.   :41.35  
 Class :character       Class :character             1st Qu.:41.38  
 Mode  :character       Mode  :character             Median :41.39  
                                                     Mean   :41.39  
                                                     3rd Qu.:41.40  
                                                     Max.   :41.46  
                                                                    
   longitude     property_type       room_type          accommodates   
 Min.   :2.092   Length:18086       Length:18086       Min.   : 1.000  
 1st Qu.:2.157   Class :character   Class :character   1st Qu.: 2.000  
 Median :2.168   Mode  :character   Mode  :character   Median : 3.000  
 Mean   :2.167                                         Mean   : 3.365  
 3rd Qu.:2.177                                         3rd Qu.: 4.000  
 Max.   :2.228                                         Max.   :16.000  
                                                                       
 bathrooms      bathrooms_text        bedrooms           beds       
 Mode:logical   Length:18086       Min.   : 1.000   Min.   : 1.000  
 NA's:18086     Class :character   1st Qu.: 1.000   1st Qu.: 1.000  
                Mode  :character   Median : 2.000   Median : 2.000  
                                   Mean   : 2.066   Mean   : 2.358  
                                   3rd Qu.: 3.000   3rd Qu.: 3.000  
                                   Max.   :12.000   Max.   :30.000  
                                   NA's   :6360     NA's   :314     
  amenities            price           minimum_nights    maximum_nights  
 Length:18086       Length:18086       Min.   :   1.00   Min.   :   1.0  
 Class :character   Class :character   1st Qu.:   1.00   1st Qu.: 180.2  
 Mode  :character   Mode  :character   Median :   3.00   Median : 365.0  
                                       Mean   :  14.76   Mean   : 574.4  
                                       3rd Qu.:  31.00   3rd Qu.:1125.0  
                                       Max.   :1125.00   Max.   :3000.0  
                                                                         
 minimum_minimum_nights maximum_minimum_nights minimum_maximum_nights
 Min.   :   1.00        Min.   :   1.00        Min.   :1.000e+00     
 1st Qu.:   1.00        1st Qu.:   3.00        1st Qu.:3.000e+02     
 Median :   2.00        Median :   5.00        Median :3.650e+02     
 Mean   :  14.54        Mean   :  18.89        Mean   :2.381e+05     
 3rd Qu.:  31.00        3rd Qu.:  31.00        3rd Qu.:1.125e+03     
 Max.   :1125.00        Max.   :2705.00        Max.   :2.147e+09     
                                                                     
 maximum_maximum_nights minimum_nights_avg_ntm maximum_nights_avg_ntm
 Min.   :1.000e+00      Min.   :   1.00        Min.   :1.000e+00     
 1st Qu.:3.330e+02      1st Qu.:   2.00        1st Qu.:3.300e+02     
 Median :9.990e+02      Median :   3.70        Median :4.070e+02     
 Mean   :2.382e+05      Mean   :  17.34        Mean   :2.381e+05     
 3rd Qu.:1.125e+03      3rd Qu.:  31.00        3rd Qu.:1.125e+03     
 Max.   :2.147e+09      Max.   :1125.00        Max.   :2.147e+09     
                                                                     
 calendar_updated has_availability availability_30  availability_60
 Mode:logical     Mode :logical    Min.   : 0.000   Min.   : 0.00  
 NA's:18086       FALSE:1188       1st Qu.: 0.000   1st Qu.: 0.00  
                  TRUE :16898      Median : 4.000   Median :13.00  
                                   Mean   : 7.718   Mean   :19.37  
                                   3rd Qu.:12.000   3rd Qu.:34.00  
                                   Max.   :30.000   Max.   :60.00  
                                                                   
 availability_90 availability_365 calendar_last_scraped number_of_reviews
 Min.   : 0.00   Min.   :  0.0    Min.   :2023-09-06    Min.   :   0.00  
 1st Qu.: 1.00   1st Qu.: 47.0    1st Qu.:2023-09-06    1st Qu.:   1.00  
 Median :35.00   Median :175.0    Median :2023-09-06    Median :   6.00  
 Mean   :36.43   Mean   :171.8    Mean   :2023-09-06    Mean   :  42.22  
 3rd Qu.:62.00   3rd Qu.:302.0    3rd Qu.:2023-09-06    3rd Qu.:  42.00  
 Max.   :90.00   Max.   :365.0    Max.   :2023-09-06    Max.   :1817.00  
                                                                         
 number_of_reviews_ltm number_of_reviews_l30d  first_review       
 Min.   :  0.00        Min.   : 0.0000        Min.   :2010-10-03  
 1st Qu.:  0.00        1st Qu.: 0.0000        1st Qu.:2017-08-16  
 Median :  2.00        Median : 0.0000        Median :2020-06-28  
 Mean   : 11.44        Mean   : 0.9239        Mean   :2019-12-27  
 3rd Qu.: 15.00        3rd Qu.: 1.0000        3rd Qu.:2022-09-25  
 Max.   :836.00        Max.   :91.0000        Max.   :2023-09-05  
                                              NA's   :4466        
  last_review         review_scores_rating review_scores_accuracy
 Min.   :2011-06-23   Min.   :0.00         Min.   :0.000         
 1st Qu.:2023-01-31   1st Qu.:4.41         1st Qu.:4.500         
 Median :2023-08-02   Median :4.68         Median :4.750         
 Mean   :2022-10-26   Mean   :4.54         Mean   :4.621         
 3rd Qu.:2023-08-22   3rd Qu.:4.90         3rd Qu.:4.930         
 Max.   :2023-09-06   Max.   :5.00         Max.   :5.000         
 NA's   :4466         NA's   :4466         NA's   :4549          
 review_scores_cleanliness review_scores_checkin review_scores_communication
 Min.   :0.000             Min.   :0.000         Min.   :0.000              
 1st Qu.:4.450             1st Qu.:4.640         1st Qu.:4.640              
 Median :4.720             Median :4.850         Median :4.850              
 Mean   :4.586             Mean   :4.711         Mean   :4.709              
 3rd Qu.:4.920             3rd Qu.:5.000         3rd Qu.:5.000              
 Max.   :5.000             Max.   :5.000         Max.   :5.000              
 NA's   :4548              NA's   :4553          NA's   :4547               
 review_scores_location review_scores_value   license          instant_bookable
 Min.   :0.000          Min.   :0.000       Length:18086       Mode :logical   
 1st Qu.:4.670          1st Qu.:4.280       Class :character   FALSE:11248     
 Median :4.830          Median :4.560       Mode  :character   TRUE :6838      
 Mean   :4.737          Mean   :4.444                                          
 3rd Qu.:5.000          3rd Qu.:4.780                                          
 Max.   :5.000          Max.   :5.000                                          
 NA's   :4552           NA's   :4553                                           
 calculated_host_listings_count calculated_host_listings_count_entire_homes
 Min.   :  1.00                 Min.   :  0.00                             
 1st Qu.:  1.00                 1st Qu.:  0.00                             
 Median :  5.00                 Median :  2.00                             
 Mean   : 31.63                 Mean   : 23.87                             
 3rd Qu.: 28.00                 3rd Qu.: 19.00                             
 Max.   :294.00                 Max.   :294.00                             
                                                                           
 calculated_host_listings_count_private_rooms
 Min.   :  0.000                             
 1st Qu.:  0.000                             
 Median :  0.000                             
 Mean   :  7.602                             
 3rd Qu.:  2.000                             
 Max.   :233.000                             
                                             
 calculated_host_listings_count_shared_rooms reviews_per_month
 Min.   : 0.00000                            Min.   : 0.010   
 1st Qu.: 0.00000                            1st Qu.: 0.240   
 Median : 0.00000                            Median : 0.850   
 Mean   : 0.08332                            Mean   : 1.436   
 3rd Qu.: 0.00000                            3rd Qu.: 2.100   
 Max.   :12.00000                            Max.   :55.020   
                                             NA's   :4466     </code></pre>
</div>
</div>
</section>
</section>
<section id="objetivo-del-proyecto" class="level1">
<h1>Objetivo del proyecto</h1>
<p>El objetivo con el análisis de datos es crear un modelo el cual enseñe a actuales o futuros propietarios de alojamientos de airbnb a obtener los máximos ingresos posibles teniendo en cuenta todas las características en del alojamiento y su perfil en Airbnb.</p>
<p>La variable a predecir es “price”, la cual es el precio de reservar cada alojamiento en su fecha de disponiblidad mas reciente.</p>
<p>El modelo ideal será en el que haya menos residuo entre los valores reales y los valores predichos.</p>
<section id="modelo-escogido" class="level2">
<h2 class="anchored" data-anchor-id="modelo-escogido">Modelo escogido</h2>
<p>El modelo escogido es una regresión lineal, que es de aprendizaje supervisado y continuo. Hemos tenido en cuenta otros posibles modelos y hemos llegado a las siguientes conclusiones:</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 45%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Modelo</th>
<th>Pros</th>
<th>Contras</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Regresión lineal</td>
<td><ul>
<li><p>Es simple y fácil de entender, los resultados pueden ser visualizados rapidamente.</p></li>
<li><p>Los coeficientes de regresión pueden interpretarse directamente.</p></li>
</ul></td>
<td><ul>
<li><p>Se basa en supuestos estrictos que muchas veces no se cumplen en datos reales.</p></li>
<li><p>Es sensible a valores atípicos.</p></li>
</ul></td>
</tr>
<tr class="even">
<td>Regresión Ridge</td>
<td><ul>
<li><p>Controla el sobreajuste, penalizando a los coeficientes grandes.</p></li>
<li><p>Menos sensible a valores atípicos.</p></li>
</ul></td>
<td><ul>
<li><p>No realiza selección de variables, todos los predictores se mantienen en el modelo.</p></li>
<li><p>Requiere la selección del parámetros de regularización.</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>Regresión Lasso</td>
<td><ul>
<li><p>Es capaz de realizar selección de variables reduciendo algunos coeficientes a cero.</p></li>
<li><p>Útil cuando se tienen muchas variables y se desea simplificar el modelo.</p></li>
</ul></td>
<td><ul>
<li><p>Puede ser inestable en la presencia de predictores altamente correlacionados.</p></li>
<li><p>También requiere la selección cuidadosa del parámetro de regularización.</p></li>
</ul></td>
</tr>
</tbody>
</table>
</section>
<section id="programa-y-paquetes-seleccionados-decisión-y-razones" class="level2">
<h2 class="anchored" data-anchor-id="programa-y-paquetes-seleccionados-decisión-y-razones">Programa y paquetes seleccionados: Decisión y razones</h2>
<p>R es un lenguaje de programación muy utilizado en estadística y aprendizaje automático debido a su gran cantidad de paquetes y funciones para análisis de datos y modelado estadístico. Su popularidad entre los estadísticos y científicos de datos se debe a la facilidad con la que se pueden manipular datos, realizar cálculos estadísticos y generar gráficos avanzados. Para esta funcionalidad concreta, en los ultimos años, han destacado dos grupos de liberías que también vamos a utilizar en nuestro modelo, como son Tidyverse y Tidymodels.</p>
<p>El tidyverse es una colección de paquetes de R diseñados para la ciencia de datos que comparten una filosofía subyacente de diseño y gramática. Algunos de los paquetes más destacados del tidyverse incluyen:</p>
<ul>
<li><p>dplyr y tidyr para la manipulación de datos.</p></li>
<li><p>Ggplot para la creación de visualizaciones avanzadas.</p></li>
</ul>
<p>Tidymodels tiene el objetivo de proporcionar una gramática coherente y fácil de usar para la modelización predictiva en R. Algunos paquetes son:</p>
<ul>
<li><p>rsample que contiene funciones para la separación de sets de un dataframe</p></li>
<li><p>yardstick: Incluye métricas para medir el rendimiento de los modelos.</p></li>
</ul>
<p>Ambos grupos de librerias tienen finalidades similares como el uso de una grámatica consistente, el formato con pipes y en general que sea legible y simple.</p>
</section>
</section>
<section id="limpieza-de-datos" class="level1">
<h1>Limpieza de datos</h1>
<p>En primer lugar vamos a eliminar aquellas variables que contienen datos que no vamos a utilizar por alguno de los siguientes motivos:</p>
<ul>
<li><p>Corresponden a links de cada una de las entradas</p></li>
<li><p>Id’s de elementos concretos que no vamos a utilizar</p></li>
<li><p>Descripciones y otros elementos strings</p></li>
<li><p>Variables cubiertas por otras las cuales estandarizan el formato</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(id,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>           host_id,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>           host_since,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>           host_response_time,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>           host_response_rate,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>           host_acceptance_rate,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>           host_is_superhost,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>           host_verifications,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>           host_has_profile_pic,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>           host_identity_verified,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>           calculated_host_listings_count,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>           calculated_host_listings_count_entire_homes,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>           calculated_host_listings_count_private_rooms,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>           calculated_host_listings_count_shared_rooms,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>           neighbourhood_group_cleansed,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>           latitude,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>           longitude,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>           room_type,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>           accommodates,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>           bathrooms_text,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>           bedrooms,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>           beds,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>           price,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>           minimum_nights,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>           maximum_nights,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>           has_availability,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>           availability_30,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>           availability_60,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>           availability_90,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>           availability_365,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>           instant_bookable,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>           number_of_reviews,</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>           number_of_reviews_l30d,</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>           review_scores_rating,</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>           review_scores_accuracy,</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>           review_scores_cleanliness,</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>           review_scores_checkin,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>           review_scores_communication,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>           review_scores_location,</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>           review_scores_value,</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>           ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="ajustes-de-formato" class="level2">
<h2 class="anchored" data-anchor-id="ajustes-de-formato">Ajustes de formato</h2>
<p><strong>host_response_time</strong></p>
<p>Nos encontramos con variables categoricas en diferentes medidas de tiempo. Sería conveniente ajustar todas estas pora que estén en la misma medida de tiempo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>host_response_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "within an hour"     "within a few hours" "within a day"      
[4] "N/A"                "a few days or more" NA                  </code></pre>
</div>
</div>
<p>Encontramos seis valores. A continuación listamos las diferentes categorías y su nuevo valor: - “within an hour” -&gt; &lt;1h - “within a few hours” -&gt; ~12h - “within a day -&gt; &lt;24h -”a few days or more” -&gt; &gt;48h - “N/A” -&gt; Unificar con NA</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_response_time <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>host_response_time <span class="sc">==</span> <span class="st">"within an hour"</span>, <span class="st">"&lt;1h"</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(df<span class="sc">$</span>host_response_time <span class="sc">==</span> <span class="st">"within a few hours"</span>, <span class="st">"~12h"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(df<span class="sc">$</span>host_response_time <span class="sc">==</span> <span class="st">"within a day"</span>, <span class="st">"~24h"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(df<span class="sc">$</span>host_response_time <span class="sc">==</span> <span class="st">"a few days or more"</span>, <span class="st">"&gt;48h"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(df<span class="sc">$</span>host_response_time <span class="sc">==</span> <span class="st">"N/A"</span>, <span class="cn">NA</span>, df<span class="sc">$</span>host_response_time)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>bathrooms_text</strong></p>
<p>Esta variable incluye el valor númerico de baños y además nos indica si estos son compartidos o no. Para la claridad en los datos sería conveniente crear dos variables de esta:</p>
<ol type="1">
<li><p>Una variable número con el número de baños.</p></li>
<li><p>Un Boolean indicando si estos son compartidos o no.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>bathrooms_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2 baths"           "1.5 baths"         "2.5 baths"        
 [4] "3 baths"           "1 shared bath"     "1 bath"           
 [7] "1 private bath"    "3.5 baths"         "4 baths"          
[10] "1.5 shared baths"  NA                  "2 shared baths"   
[13] "2.5 shared baths"  "5.5 baths"         "7.5 baths"        
[16] "4.5 baths"         "6 baths"           "0 shared baths"   
[19] "Half-bath"         "Private half-bath" "0 baths"          
[22] "5 baths"           "8 baths"           "3 shared baths"   
[25] "8 shared baths"    "4 shared baths"    "Shared half-bath" 
[28] "5 shared baths"    "3.5 shared baths"  "6 shared baths"   
[31] "5.5 shared baths"  "10 baths"          "10 shared baths"  
[34] "6.5 baths"         "4.5 shared baths" </code></pre>
</div>
</div>
<p>Vemos que casi todas las categorías tienen números. A excepción de tres de ellas. Vamos a añadirselo para compartir la estructura:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bathrooms_text <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>bathrooms_text <span class="sc">==</span> <span class="st">"Shared half-bath"</span>, <span class="st">"0.5 Shared bath"</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(df<span class="sc">$</span>bathrooms_text <span class="sc">==</span> <span class="st">"Private half-bath"</span>, <span class="st">"0.5 bath"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(df<span class="sc">$</span>bathrooms_text <span class="sc">==</span> <span class="st">"Half-bath"</span>, <span class="st">"0.5 bath"</span>, df<span class="sc">$</span>bathrooms_text)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación creamos la columna boolean la cual nos indica si un baño es compartido o no (Asumimos que si no es indicado, es privado).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>shared_bathrooms <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"shared|Shared"</span>, df<span class="sc">$</span>bathrooms_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Seguidamente creamos una nueva columna que extraiga el número de baños del valor bathrooms_text</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>n_bathrooms <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(df<span class="sc">$</span>bathrooms_text, <span class="st">" "</span>), <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(x[<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recolocamos las columnas en la posición de bathrooms_text y eliminamos esta.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>bathrooms_text_position <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(df) <span class="sc">==</span> <span class="st">"bathrooms_text"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"n_bathrooms"</span>, <span class="st">"shared_bathrooms"</span>)), <span class="at">.before =</span> bathrooms_text_position)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(bathrooms_text_position)

  # Now:
  data %&gt;% select(all_of(bathrooms_text_position))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>bathrooms_text)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(bathrooms_text_position)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>host_verifications</strong></p>
<p>En esta variable podemos ver en formato lista, los medios por los cuales se ha verificado un host. Para que los datos sean mas accesibles podemos crear una variable de tipo boolean por cada tipo de medio posible de verificación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>host_verifications)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "['email', 'phone']"               "['email', 'phone', 'work_email']"
[3] "['phone', 'work_email']"          "['phone']"                       
[5] "['email']"                        "None"                            
[7] "[]"                               "['work_email']"                  </code></pre>
</div>
</div>
<p>Encontramos tres tipos de verificación:</p>
<ul>
<li><p>“email”</p></li>
<li><p>“phone”</p></li>
<li><p>“work_email”</p></li>
</ul>
<p>Creamos las tres variables y añadimos true si ese método está incluido en la columna host_verifications.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">verification_email =</span> <span class="fu">str_detect</span>(df<span class="sc">$</span>host_verifications, <span class="st">"email"</span>),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">verification_phone =</span> <span class="fu">str_detect</span>(df<span class="sc">$</span>host_verifications, <span class="st">"phone"</span>),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">verification_work_email =</span> <span class="fu">str_detect</span>(df<span class="sc">$</span>host_verifications, <span class="st">"work_email"</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>host_verification_text_position <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(df) <span class="sc">==</span> <span class="st">"host_verifications"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"verification_email"</span>, <span class="st">"verification_phone"</span>, <span class="st">"verification_work_email"</span>)), <span class="at">.before =</span> host_verification_text_position)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(host_verification_text_position)

  # Now:
  data %&gt;% select(all_of(host_verification_text_position))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>host_verifications)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(host_verification_text_position)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>price</strong></p>
<p>Podemos convertir price en una variable numérica para poderla usar en visualizaciones y otros tipos de funciones de tipo continuo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>price <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">$"</span>, <span class="st">""</span>, df<span class="sc">$</span>price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
</div>
<p><strong>review_score_rating</strong></p>
<p>El valor mínimo que puede tener un alojamiento es 1. En algunos campos pone 0 a causa de que el resto de valores son NA. Vamos a modificar estos valores a NA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>review_scores_rating <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>review_scores_rating <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, df<span class="sc">$</span>review_scores_rating)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>host_response_rate y host_acceptance_rate</strong></p>
<p>Cambiamos ambas variables de tipo character con porcentaje a tipo numérico double:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_response_rate <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">"%"</span>, <span class="st">""</span>, df<span class="sc">$</span>host_response_rate))<span class="sc">/</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_acceptance_rate <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">"%"</span>, <span class="st">""</span>, df<span class="sc">$</span>host_acceptance_rate))<span class="sc">/</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
</div>
<p><strong>Conversión de campos con tags en factores</strong></p>
<p>Cambiamos todas las columnas de tipos strings que tengan etiquetas a tipo factor para que su uso sea mas sencillo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">host_response_time =</span> <span class="fu">factor</span>(host_response_time),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">neighbourhood_group_cleansed =</span> <span class="fu">factor</span>(neighbourhood_group_cleansed),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">room_type =</span> <span class="fu">factor</span>(room_type)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tratamiento-de-nas" class="level2">
<h2 class="anchored" data-anchor-id="tratamiento-de-nas">Tratamiento de NA’s</h2>
<p>Comprobamos cuantos NA’s faltan en cada columna para ver que tratamiento hacer con ellos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>na_analysis <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>na_analysis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 43
     id host_id host_since host_response_time host_response_rate
  &lt;int&gt;   &lt;int&gt;      &lt;int&gt;              &lt;int&gt;              &lt;int&gt;
1     0       0          2               2963               2963
# ℹ 38 more variables: host_acceptance_rate &lt;int&gt;, host_is_superhost &lt;int&gt;,
#   verification_email &lt;int&gt;, verification_phone &lt;int&gt;,
#   verification_work_email &lt;int&gt;, host_has_profile_pic &lt;int&gt;,
#   host_identity_verified &lt;int&gt;, calculated_host_listings_count &lt;int&gt;,
#   calculated_host_listings_count_entire_homes &lt;int&gt;,
#   calculated_host_listings_count_private_rooms &lt;int&gt;,
#   calculated_host_listings_count_shared_rooms &lt;int&gt;, …</code></pre>
</div>
</div>
<p><strong>Columnas numéricas</strong></p>
<p>En primer lugar vamos a promediar todas las columnas númericas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(.))) <span class="fu">floor</span>(<span class="fu">replace_na</span>(., <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="cf">else</span> .))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>host_response_time</strong></p>
<p>Vamos a hacer una tablaq para ver la distribución de cada categoría:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>frecuencias_host_response_time <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>host_response_time)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>porcentajes_host_response_time <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(frecuencias_host_response_time) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(porcentajes_host_response_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      &lt;1h      &gt;48h      ~12h      ~24h 
71.936785  1.937446 15.823580 10.302189 </code></pre>
</div>
</div>
<p>Vemos como la gran mayoría responde en menos de una hora, al no ser un componente mayor esta variable vamos a justar los NA’s como menores de una hora.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_response_time[<span class="fu">is.na</span>(df<span class="sc">$</span>host_response_time)] <span class="ot">&lt;-</span> <span class="st">"&lt;1h"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>host_is_superhost</strong></p>
<p>Como no tenemos información asumimos que los valores NA son false</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_is_superhost[<span class="fu">is.na</span>(df<span class="sc">$</span>host_is_superhost)] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>host_has_profile_pic</strong></p>
<p>Hacemos la misma gestión en este caso</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_has_profile_pic[<span class="fu">is.na</span>(df<span class="sc">$</span>host_has_profile_pic)] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>host_identity_verified</strong></p>
<p>Volvemos a convertir los valores NA que tenemos en FALSE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_identity_verified[<span class="fu">is.na</span>(df<span class="sc">$</span>host_identity_verified)] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>host_since</strong></p>
<p>Vamos a usar el valor promedio para sustituir los NA de la fecha de ingreso de los host</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mean_host_since <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>host_since, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>host_since[<span class="fu">is.na</span>(df<span class="sc">$</span>host_since)] <span class="ot">&lt;-</span> mean_host_since</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="análisis-descriptivo-de-los-datos" class="level1">
<h1>Análisis descriptivo de los datos</h1>
<p>Vamos a hacer un análisis descriptivo de nuestros datos para poder tendencias y patrones para poder tomar decisiones sobre el modelo mas adelante.</p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Vamos a ver como quedaría el summary después de haber limpiado los datos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id               host_id            host_since        
 Min.   :1.867e+04   Min.   :     3073   Min.   :2008-09-19  
 1st Qu.:2.172e+07   1st Qu.:  9919300   1st Qu.:2013-11-10  
 Median :4.435e+07   Median : 96299106   Median :2016-09-22  
 Mean   :2.997e+17   Mean   :166184865   Mean   :2016-12-27  
 3rd Qu.:7.450e+17   3rd Qu.:310348791   3rd Qu.:2019-11-17  
 Max.   :9.740e+17   Max.   :535400790   Max.   :2023-09-04  
                                                             
 host_response_time host_response_rate host_acceptance_rate host_is_superhost
 &lt;1h :13842         Min.   :0.0000     Min.   :0.0000       Mode :logical    
 &gt;48h:  293         1st Qu.:0.0000     1st Qu.:0.0000       FALSE:14999      
 ~12h: 2393         Median :0.0000     Median :0.0000       TRUE :3087       
 ~24h: 1558         Mean   :0.4511     Mean   :0.2769                        
                    3rd Qu.:1.0000     3rd Qu.:1.0000                        
                    Max.   :1.0000     Max.   :1.0000                        
                                                                             
 verification_email verification_phone verification_work_email
 Mode :logical      Mode :logical      Mode :logical          
 FALSE:1264         FALSE:43           FALSE:15153            
 TRUE :16822        TRUE :18043        TRUE :2933             
                                                              
                                                              
                                                              
                                                              
 host_has_profile_pic host_identity_verified calculated_host_listings_count
 Mode :logical        Mode :logical          Min.   :  1.00                
 FALSE:332            FALSE:1473             1st Qu.:  1.00                
 TRUE :17754          TRUE :16613            Median :  5.00                
                                             Mean   : 31.63                
                                             3rd Qu.: 28.00                
                                             Max.   :294.00                
                                                                           
 calculated_host_listings_count_entire_homes
 Min.   :  0.00                             
 1st Qu.:  0.00                             
 Median :  2.00                             
 Mean   : 23.87                             
 3rd Qu.: 19.00                             
 Max.   :294.00                             
                                            
 calculated_host_listings_count_private_rooms
 Min.   :  0.000                             
 1st Qu.:  0.000                             
 Median :  0.000                             
 Mean   :  7.602                             
 3rd Qu.:  2.000                             
 Max.   :233.000                             
                                             
 calculated_host_listings_count_shared_rooms      neighbourhood_group_cleansed
 Min.   : 0.00000                            Eixample           :6469         
 1st Qu.: 0.00000                            Ciutat Vella       :4218         
 Median : 0.00000                            Sants-Montjuïc     :1883         
 Mean   : 0.08332                            Sant Martí         :1662         
 3rd Qu.: 0.00000                            Gràcia             :1591         
 Max.   :12.00000                            Sarrià-Sant Gervasi: 890         
                                             (Other)            :1373         
    latitude       longitude               room_type      accommodates   
 Min.   :41.35   Min.   :2.092   Entire home/apt:10622   Min.   : 1.000  
 1st Qu.:41.38   1st Qu.:2.157   Hotel room     :  134   1st Qu.: 2.000  
 Median :41.39   Median :2.168   Private room   : 7173   Median : 3.000  
 Mean   :41.39   Mean   :2.167   Shared room    :  157   Mean   : 3.365  
 3rd Qu.:41.40   3rd Qu.:2.177                           3rd Qu.: 4.000  
 Max.   :41.46   Max.   :2.228                           Max.   :16.000  
                                                                         
  n_bathrooms     shared_bathrooms    bedrooms           beds       
 Min.   : 0.000   Mode :logical    Min.   : 1.000   Min.   : 1.000  
 1st Qu.: 1.000   FALSE:13774      1st Qu.: 2.000   1st Qu.: 1.000  
 Median : 1.000   TRUE :4312       Median : 2.000   Median : 2.000  
 Mean   : 1.309                    Mean   : 2.043   Mean   : 2.351  
 3rd Qu.: 2.000                    3rd Qu.: 2.000   3rd Qu.: 3.000  
 Max.   :10.000                    Max.   :12.000   Max.   :30.000  
                                                                    
     price       minimum_nights    maximum_nights   has_availability
 Min.   :  8.0   Min.   :   1.00   Min.   :   1.0   Mode :logical   
 1st Qu.: 52.0   1st Qu.:   1.00   1st Qu.: 180.2   FALSE:1188      
 Median :100.0   Median :   3.00   Median : 365.0   TRUE :16898     
 Mean   :135.1   Mean   :  14.76   Mean   : 574.4                   
 3rd Qu.:182.0   3rd Qu.:  31.00   3rd Qu.:1125.0                   
 Max.   :999.0   Max.   :1125.00   Max.   :3000.0                   
                                                                    
 availability_30  availability_60 availability_90 availability_365
 Min.   : 0.000   Min.   : 0.00   Min.   : 0.00   Min.   :  0.0   
 1st Qu.: 0.000   1st Qu.: 0.00   1st Qu.: 1.00   1st Qu.: 47.0   
 Median : 4.000   Median :13.00   Median :35.00   Median :175.0   
 Mean   : 7.718   Mean   :19.37   Mean   :36.43   Mean   :171.8   
 3rd Qu.:12.000   3rd Qu.:34.00   3rd Qu.:62.00   3rd Qu.:302.0   
 Max.   :30.000   Max.   :60.00   Max.   :90.00   Max.   :365.0   
                                                                  
 instant_bookable number_of_reviews number_of_reviews_l30d review_scores_rating
 Mode :logical    Min.   :   0.00   Min.   : 0.0000        Min.   :1.00        
 FALSE:11248      1st Qu.:   1.00   1st Qu.: 0.0000        1st Qu.:4.00        
 TRUE :6838       Median :   6.00   Median : 0.0000        Median :4.00        
                  Mean   :  42.22   Mean   : 0.9239        Mean   :4.08        
                  3rd Qu.:  42.00   3rd Qu.: 1.0000        3rd Qu.:4.00        
                  Max.   :1817.00   Max.   :91.0000        Max.   :5.00        
                                                                               
 review_scores_accuracy review_scores_cleanliness review_scores_checkin
 Min.   :0.0            Min.   :0.000             Min.   :0.000        
 1st Qu.:4.0            1st Qu.:4.000             1st Qu.:4.000        
 Median :4.0            Median :4.000             Median :4.000        
 Mean   :4.1            Mean   :4.085             Mean   :4.165        
 3rd Qu.:4.0            3rd Qu.:4.000             3rd Qu.:4.000        
 Max.   :5.0            Max.   :5.000             Max.   :5.000        
                                                                       
 review_scores_communication review_scores_location review_scores_value
 Min.   :0.000               Min.   :0.000          Min.   :0.000      
 1st Qu.:4.000               1st Qu.:4.000          1st Qu.:4.000      
 Median :4.000               Median :4.000          Median :4.000      
 Mean   :4.165               Mean   :4.167          Mean   :4.009      
 3rd Qu.:4.000               3rd Qu.:4.000          3rd Qu.:4.000      
 Max.   :5.000               Max.   :5.000          Max.   :5.000      
                                                                       </code></pre>
</div>
</div>
</section>
<section id="distribución-de-las-notas-de-review" class="level2">
<h2 class="anchored" data-anchor-id="distribución-de-las-notas-de-review">Distribución de las notas de review</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Histograma distribución de ratings"</span>) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Review Scores Rating"</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frecuencia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AirbnbAB_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>En el gráfico podemos ver como la gran mayoría de reseñas tienen un nivel de entre 4 y 5, siendo 4 con mucha diferencia la moda. Vemos como las notas entre 1 y 3 son mínimas.</p>
</section>
<section id="distribución-del-precio-por-noche" class="level2">
<h2 class="anchored" data-anchor-id="distribución-del-precio-por-noche">Distribución del precio por noche</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>price, <span class="at">main =</span> <span class="st">"Histograma distribución precio"</span>, <span class="at">breaks=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AirbnbAB_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>El rango de precios con mayor frecuencia esta entre 0 y 100, por otro lado existen pocas observaciones con precios superiores a 400. La distribución de los precios es asimétrica positiva (sesgada a la derecha), con una cola larga que se extiende hacia los precios más altos lo que implica que las frecuencias de precios disminuyen rápidamente a medida que aumenta el precio.</p>
</section>
<section id="distribución-entre-precio-y-reviews" class="level2">
<h2 class="anchored" data-anchor-id="distribución-entre-precio-y-reviews">Distribución entre precio y reviews</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(price, review_scores_rating)) <span class="sc">+</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AirbnbAB_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Existe una tendencia que muestra que a medida que el precio aumenta, las calificaciones de revisión tienden a mejorar, especialmente después del punto de precio de 750. El intervalo de confianza se amplía a medida que el precio aumenta, lo que sugiere que hay más variabilidad en las calificaciones de revisión para productos o servicios más caros. La mayoría de los datos parece estar concentrada en el rango de precios más bajo.</p>
</section>
<section id="media-de-precio-por-barrio" class="level2">
<h2 class="anchored" data-anchor-id="media-de-precio-por-barrio">Media de precio por barrio</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df_precio_barrio <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">select</span>(price, neighbourhood_group_cleansed) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(neighbourhood_group_cleansed) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">avg_price =</span> <span class="fu">mean</span>(price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_precio_barrio, <span class="fu">aes</span>(<span class="fu">reorder</span>(neighbourhood_group_cleansed, avg_price), avg_price)) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AirbnbAB_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hay una variabilidad notable en los precios promedio entre los diferentes barrios. Eixample parece ser el barrio con el precio promedio más alto, seguido de cerca por Sarrià-Sant Gervasi. Por otro lado, Nou Barris parece ser el más económico en términos de precio promedio.</p>
</section>
</section>
<section id="separación-de-modelo-en-sets" class="level1">
<h1>Separación de modelo en sets</h1>
<p>Queremos separar nuestro modelo en 3 para poder ver la efectividad de este. Usaremos un set de entrenamiento, otro de test y otro de validación. A medido que avancemos iré comprobando la efectividad del test y una vez veamos que es efectivo haremos la validación global.</p>
<p>Como hemos podido ver en el analisis descriptivo encontrabamos mucha diferencia de valores en <em>price</em> dependiendo del barrio en el que estuvieran situadas. Por ello, vamos a hacer una distribución proporcional de valores en cada uno de los sets.</p>
<p>Primer retiramos las variables id para los sets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>host_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>training_test_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(df, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> neighbourhood_group_cleansed)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear los data frames de entrenamiento y el resto</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> <span class="fu">training</span>(training_test_split)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(training_test_split)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(training_test_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="primer-modelo" class="level1">
<h1>Primer modelo</h1>
<p>Vamos a hacer una prueba con el primer modelo para ver que resultados obtenemos y como podemos mejorarlo aplicando técnicas estadísticas.</p>
<p>En este caso solo vamos a aplicar las variables numéricas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>training_data1 <span class="ot">&lt;-</span> training_data <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Las aplicamos al modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> training_data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Duplicamos test_data para esta prueba</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>test_data1 <span class="ot">&lt;-</span> test_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Predecimos con el test_data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>predicciones_modelo1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo1, <span class="at">newdata =</span> test_data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Añadimos las predicciones una columna para comparar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>test_data1 <span class="ot">&lt;-</span> test_data1 <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicciones =</span> predicciones_modelo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calcular las métricas resultantes la variable price</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>metrics1 <span class="ot">&lt;-</span> test_data1 <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> price, <span class="at">estimate =</span> predicciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegurarse de que 'predicciones' es un vector numérico sin nombres</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>test_data1<span class="sc">$</span>predicciones <span class="ot">&lt;-</span> <span class="fu">unname</span>(test_data1<span class="sc">$</span>predicciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculamos el promedio de residuos y lo agregamos al data.frame de metrics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>residuo1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(modelo1))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>residuo1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuo"</span>, <span class="st">"standard"</span>, residuo1)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>metrics1 <span class="ot">&lt;-</span><span class="fu">rbind</span>(metrics1, residuo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transformación-de-variables-en-valores-numéricos-y-estandarización" class="level1">
<h1><strong>Transformación de variables en valores numéricos y estandarización</strong></h1>
<p>A continuación, vamos a realizar cambios en las variables que no son de tipo numérico para poder ser incluidas en la regresión lineal:</p>
<ul>
<li><p>Para interactuar con la fecha nos vamos a quedar simplemente con el año de ingreso en la plataforma en host_since</p></li>
<li><p>Escalamos las variables numéricas</p></li>
<li><p>Convertiremos los booleanos a numéricos</p></li>
<li><p>Usamos datos dummy para las columnas categóricas</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> training_data <span class="sc">|&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">host_since =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(host_since, <span class="st">"%Y"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), scale)) <span class="sc">|&gt;</span> </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.logical), as.numeric))</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">host_since =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(host_since, <span class="st">"%Y"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), scale)) <span class="sc">|&gt;</span> </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.logical), as.numeric))</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> <span class="fu">dummy_cols</span>(training_data, </span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">select_columns =</span> <span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(training_data, is.factor))),</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">remove_selected_columns =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">dummy_cols</span>(test_data, </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">select_columns =</span> <span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(test_data, is.factor))),</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">remove_selected_columns =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="segundo-modelo" class="level1">
<h1>Segundo modelo</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En este caso solo vamos a aplicar las variables numéricas.</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>training_data2 <span class="ot">&lt;-</span> training_data  </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Las aplicamos al modelo</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>modelo2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> training_data2)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicamos test_data para esta prueba</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>test_data2 <span class="ot">&lt;-</span> test_data</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecimos con el test_data</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>predicciones_modelo2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo2, <span class="at">newdata =</span> test_data2)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadimos las predicciones una columna para comparar</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>test_data2 <span class="ot">&lt;-</span> test_data2 <span class="sc">%&gt;%</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicciones =</span> predicciones_modelo2)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular las métricas resultantes la variable price</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>metrics2 <span class="ot">&lt;-</span> test_data2 <span class="sc">%&gt;%</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> price, <span class="at">estimate =</span> predicciones)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegurarse de que 'predicciones' es un vector numérico sin nombres</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>test_data2<span class="sc">$</span>predicciones <span class="ot">&lt;-</span> <span class="fu">unname</span>(test_data2<span class="sc">$</span>predicciones)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos el promedio de residuos y lo agregamos al data.frame de metrics</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>residuo2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(modelo2))</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>residuo2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuo"</span>, <span class="st">"standard"</span>, residuo2)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>metrics2 <span class="ot">&lt;-</span><span class="fu">rbind</span>(metrics2, residuo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="análisis-de-componentes-principales" class="level1">
<h1>Análisis de componentes principales</h1>
<p>Vamos a realizar el análisis de componentes principales, ya que tenemos un total de 43 variables, entonces vamos a ver cuales son las mas relevantes para nuestro modelo:</p>
<p>Vamos a utilizar la función pccomp para aplicar el PCA</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(training_data, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1   PC2     PC3     PC4    PC5     PC6     PC7
Standard deviation     2.2266 1.931 1.70541 1.54084 1.2403 1.19012 1.14289
Proportion of Variance 0.1569 0.118 0.09207 0.07516 0.0487 0.04484 0.04135
Cumulative Proportion  0.1569 0.275 0.36704 0.44220 0.4909 0.53574 0.57709
                           PC8     PC9    PC10    PC11    PC12    PC13    PC14
Standard deviation     1.08057 1.03985 1.00771 0.95473 0.91907 0.87915 0.82879
Proportion of Variance 0.03696 0.03423 0.03215 0.02886 0.02674 0.02447 0.02174
Cumulative Proportion  0.61405 0.64828 0.68042 0.70928 0.73602 0.76049 0.78223
                         PC15    PC16    PC17    PC18    PC19    PC20    PC21
Standard deviation     0.7969 0.77042 0.75043 0.71498 0.70163 0.64249 0.62454
Proportion of Variance 0.0201 0.01879 0.01783 0.01618 0.01558 0.01307 0.01235
Cumulative Proportion  0.8023 0.82113 0.83895 0.85513 0.87072 0.88379 0.89613
                          PC22    PC23    PC24    PC25    PC26    PC27    PC28
Standard deviation     0.61392 0.53499 0.51869 0.50456 0.49769 0.46253 0.44662
Proportion of Variance 0.01193 0.00906 0.00852 0.00806 0.00784 0.00677 0.00631
Cumulative Proportion  0.90807 0.91713 0.92564 0.93370 0.94154 0.94832 0.95463
                          PC29    PC30    PC31    PC32    PC33    PC34    PC35
Standard deviation     0.40400 0.38497 0.36813 0.35794 0.33608 0.33070 0.30716
Proportion of Variance 0.00517 0.00469 0.00429 0.00406 0.00358 0.00346 0.00299
Cumulative Proportion  0.95980 0.96449 0.96878 0.97283 0.97641 0.97987 0.98286
                         PC36    PC37    PC38    PC39    PC40    PC41    PC42
Standard deviation     0.2919 0.27896 0.27066 0.24328 0.23427 0.18280 0.16969
Proportion of Variance 0.0027 0.00246 0.00232 0.00187 0.00174 0.00106 0.00091
Cumulative Proportion  0.9856 0.98802 0.99034 0.99221 0.99395 0.99501 0.99592
                          PC43    PC44    PC45    PC46    PC47    PC48    PC49
Standard deviation     0.15306 0.14298 0.13266 0.12822 0.11115 0.10987 0.10642
Proportion of Variance 0.00074 0.00065 0.00056 0.00052 0.00039 0.00038 0.00036
Cumulative Proportion  0.99666 0.99731 0.99786 0.99839 0.99878 0.99916 0.99952
                          PC50    PC51    PC52     PC53      PC54      PC55
Standard deviation     0.08365 0.07668 0.04854 0.004806 5.147e-15 2.325e-15
Proportion of Variance 0.00022 0.00019 0.00007 0.000000 0.000e+00 0.000e+00
Cumulative Proportion  0.99974 0.99992 1.00000 1.000000 1.000e+00 1.000e+00
                            PC56
Standard deviation     1.759e-15
Proportion of Variance 0.000e+00
Cumulative Proportion  1.000e+00</code></pre>
</div>
</div>
<p>Vamos a hacer un Scree plot para ver cual es el número de componentes principales ideal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>scree_plot <span class="ot">&lt;-</span> <span class="fu">plot</span>(pca_result, <span class="at">type =</span> <span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AirbnbAB_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hacemos también un biplot para ver las variables correspondientes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(pca_result, </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">label=</span><span class="st">"var"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AirbnbAB_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Queremos visualizar las cargas de cada componente y ver que variables tienen mayor influencia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>loadings <span class="ot">&lt;-</span> pca_result<span class="sc">$</span>rotation</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver las cargas para los primeros cinco componentes principales</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>loadings[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                           PC1           PC2
host_since                                       -1.329794e-02  0.0600468772
host_response_rate                               -1.506824e-02 -0.0827350674
host_acceptance_rate                              1.510227e-02 -0.1012475554
host_is_superhost                                -1.367036e-02 -0.0199229726
verification_email                                2.763991e-03 -0.0082802230
verification_phone                                5.304676e-04 -0.0011367906
verification_work_email                           1.310210e-02 -0.0246635517
host_has_profile_pic                              1.389175e-04 -0.0015329134
host_identity_verified                            1.406812e-02 -0.0359118977
calculated_host_listings_count                    8.885619e-02 -0.0777939849
calculated_host_listings_count_entire_homes       9.014873e-02 -0.1464410138
calculated_host_listings_count_private_rooms      1.582687e-02  0.1000974203
calculated_host_listings_count_shared_rooms       4.646351e-03  0.0003550779
latitude                                          2.280411e-03  0.0011033939
longitude                                        -1.012975e-02  0.0012180506
accommodates                                      1.542212e-01 -0.3582400287
n_bathrooms                                       7.952464e-02 -0.1948566849
shared_bathrooms                                 -2.628781e-02  0.0783844509
bedrooms                                          1.044553e-01 -0.2450313646
beds                                              1.498007e-01 -0.3346220856
price                                             1.188991e-01 -0.3161530926
minimum_nights                                   -4.972958e-02  0.0535750381
maximum_nights                                    2.083702e-02 -0.0232843628
has_availability                                  1.354768e-02 -0.0356863188
availability_30                                   1.058507e-01 -0.2689988576
availability_60                                   1.150830e-01 -0.2823692393
availability_90                                   1.290433e-01 -0.3000048211
availability_365                                  1.021080e-01 -0.2304152371
instant_bookable                                  3.610544e-02 -0.0533977259
number_of_reviews                                 8.571696e-02 -0.0620207138
number_of_reviews_l30d                            5.699088e-02 -0.0704526095
review_scores_rating                             -3.742444e-01 -0.1653872979
review_scores_accuracy                           -3.681967e-01 -0.1590602539
review_scores_cleanliness                        -3.288750e-01 -0.1621079173
review_scores_checkin                            -3.415546e-01 -0.1331689109
review_scores_communication                      -3.525812e-01 -0.1415901566
review_scores_location                           -3.035424e-01 -0.1188669675
review_scores_value                              -3.409034e-01 -0.1489737754
host_response_time_&lt;1h                            8.936130e-03 -0.0181814663
host_response_time_&gt;48h                          -8.314110e-04  0.0011442877
host_response_time_~12h                          -3.948391e-03  0.0033565281
host_response_time_~24h                          -4.156328e-03  0.0136806505
neighbourhood_group_cleansed_Ciutat Vella        -1.205371e-02  0.0236200658
neighbourhood_group_cleansed_Eixample             1.253710e-02 -0.0328179915
neighbourhood_group_cleansed_Gràcia               1.981800e-03 -0.0009039891
neighbourhood_group_cleansed_Horta-Guinardó       2.410852e-04  0.0051592680
neighbourhood_group_cleansed_Les Corts           -3.169725e-05 -0.0005420218
neighbourhood_group_cleansed_Nou Barris          -5.695354e-04  0.0023659183
neighbourhood_group_cleansed_Sant Andreu         -1.835902e-03  0.0022127315
neighbourhood_group_cleansed_Sant Martí          -1.560804e-03 -0.0014779770
neighbourhood_group_cleansed_Sants-Montjuïc       1.185339e-04  0.0038832191
neighbourhood_group_cleansed_Sarrià-Sant Gervasi  1.173125e-03 -0.0014992234
room_type_Entire home/apt                         4.501571e-02 -0.1177308016
room_type_Hotel room                             -6.299076e-04 -0.0014842007
room_type_Private room                           -4.505813e-02  0.1197540981
room_type_Shared room                             6.723325e-04 -0.0005390958
                                                           PC3           PC4
host_since                                       -0.2088346520  0.0510071397
host_response_rate                               -0.0539675008 -0.3521861395
host_acceptance_rate                             -0.0936141586 -0.2398610348
host_is_superhost                                 0.0136690136 -0.0844453789
verification_email                                0.0114193918  0.0025701272
verification_phone                               -0.0006214859 -0.0001126510
verification_work_email                           0.0321680337  0.0467680109
host_has_profile_pic                              0.0092739799  0.0017763847
host_identity_verified                           -0.0233973805 -0.0006013192
calculated_host_listings_count                    0.0257247502  0.5280374449
calculated_host_listings_count_entire_homes       0.0811329621  0.4161606737
calculated_host_listings_count_private_rooms     -0.0867688093  0.2949745710
calculated_host_listings_count_shared_rooms      -0.0282702279  0.0011387480
latitude                                          0.0198275337 -0.0376246988
longitude                                         0.0090864595 -0.0616367743
accommodates                                      0.2895985923 -0.0254703211
n_bathrooms                                       0.1884428122  0.1139661282
shared_bathrooms                                 -0.0454644862 -0.0044994108
bedrooms                                          0.2760289457  0.0479025241
beds                                              0.2816140166 -0.0049099798
price                                             0.1599195379 -0.0683033624
minimum_nights                                   -0.0480298108  0.1499057048
maximum_nights                                    0.0617814506 -0.0759677650
has_availability                                 -0.0231607370 -0.0041115488
availability_30                                  -0.3980835741  0.0024607266
availability_60                                  -0.4338196680  0.0108998670
availability_90                                  -0.4105238328 -0.0063265263
availability_365                                 -0.2657484376  0.0635007750
instant_bookable                                 -0.0309782687 -0.0339443865
number_of_reviews                                 0.1040138507 -0.3353858360
number_of_reviews_l30d                            0.0036729611 -0.2935354540
review_scores_rating                              0.0059930924  0.0154329047
review_scores_accuracy                            0.0121662861  0.0242194045
review_scores_cleanliness                        -0.0052088973  0.0245073461
review_scores_checkin                            -0.0084051610  0.0039899424
review_scores_communication                      -0.0040230510  0.0092521951
review_scores_location                           -0.0033231582  0.0589862970
review_scores_value                               0.0281256056 -0.0003308220
host_response_time_&lt;1h                            0.0202009453 -0.0472507624
host_response_time_&gt;48h                          -0.0033893354  0.0023887155
host_response_time_~12h                          -0.0023128998  0.0104544173
host_response_time_~24h                          -0.0144987101  0.0344076295
neighbourhood_group_cleansed_Ciutat Vella        -0.0288505034 -0.0008779528
neighbourhood_group_cleansed_Eixample             0.0392741900  0.0198844444
neighbourhood_group_cleansed_Gràcia              -0.0020103956 -0.0013702546
neighbourhood_group_cleansed_Horta-Guinardó      -0.0019060571 -0.0032291175
neighbourhood_group_cleansed_Les Corts            0.0013907935  0.0005662008
neighbourhood_group_cleansed_Nou Barris          -0.0028508955 -0.0019151077
neighbourhood_group_cleansed_Sant Andreu         -0.0011854522 -0.0009796646
neighbourhood_group_cleansed_Sant Martí           0.0025652553 -0.0165772490
neighbourhood_group_cleansed_Sants-Montjuïc      -0.0038138222 -0.0043432135
neighbourhood_group_cleansed_Sarrià-Sant Gervasi -0.0026131128  0.0088419145
room_type_Entire home/apt                         0.0912746021  0.0054439093
room_type_Hotel room                             -0.0025575390 -0.0028117113
room_type_Private room                           -0.0859278026 -0.0006926291
room_type_Shared room                            -0.0027892605 -0.0019395689
                                                           PC5
host_since                                       -0.2204167432
host_response_rate                               -0.0462318593
host_acceptance_rate                              0.1153871668
host_is_superhost                                 0.0339606899
verification_email                                0.0114422775
verification_phone                                0.0010527661
verification_work_email                           0.0684347398
host_has_profile_pic                              0.0095338017
host_identity_verified                            0.0279872719
calculated_host_listings_count                    0.3282649777
calculated_host_listings_count_entire_homes       0.4453477339
calculated_host_listings_count_private_rooms     -0.1293635123
calculated_host_listings_count_shared_rooms      -0.0622836078
latitude                                         -0.0788645990
longitude                                        -0.0362393383
accommodates                                     -0.0861829186
n_bathrooms                                      -0.3351919991
shared_bathrooms                                 -0.0721513994
bedrooms                                         -0.3182836001
beds                                             -0.1534420560
price                                             0.0297888200
minimum_nights                                   -0.1667698788
maximum_nights                                    0.0027743017
has_availability                                  0.0270989318
availability_30                                  -0.1067672933
availability_60                                  -0.0565450039
availability_90                                   0.0094036250
availability_365                                  0.0586712414
instant_bookable                                  0.0693660438
number_of_reviews                                 0.3606523420
number_of_reviews_l30d                            0.3560720235
review_scores_rating                              0.0374610612
review_scores_accuracy                            0.0336798345
review_scores_cleanliness                         0.0495934344
review_scores_checkin                            -0.0221275293
review_scores_communication                       0.0088569349
review_scores_location                           -0.0187894211
review_scores_value                               0.0374091340
host_response_time_&lt;1h                            0.0545077367
host_response_time_&gt;48h                          -0.0070998954
host_response_time_~12h                          -0.0202826472
host_response_time_~24h                          -0.0271251942
neighbourhood_group_cleansed_Ciutat Vella        -0.0179801694
neighbourhood_group_cleansed_Eixample             0.0345009163
neighbourhood_group_cleansed_Gràcia               0.0081219490
neighbourhood_group_cleansed_Horta-Guinardó      -0.0063807623
neighbourhood_group_cleansed_Les Corts           -0.0009901357
neighbourhood_group_cleansed_Nou Barris          -0.0054226138
neighbourhood_group_cleansed_Sant Andreu         -0.0048427055
neighbourhood_group_cleansed_Sant Martí          -0.0128668951
neighbourhood_group_cleansed_Sants-Montjuïc       0.0137072066
neighbourhood_group_cleansed_Sarrià-Sant Gervasi -0.0078467900
room_type_Entire home/apt                         0.1062638271
room_type_Hotel room                              0.0016725317
room_type_Private room                           -0.1045304097
room_type_Shared room                            -0.0034059491</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la matriz de cargas en un data frame</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>loadings_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(loadings) <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PC1, PC2, PC3, PC4, PC5)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sumamos los PC de cada variable</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>loadings_df<span class="sc">$</span>Suma <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(loadings_df[, <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>, <span class="st">"PC5"</span>)]) </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>loadings_df_sorted <span class="ot">&lt;-</span> loadings_df <span class="sc">|&gt;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Suma))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El resultado es bastante sorprendente, pero tiene sentido vemos que las variables mas relevantes en primer lugar son el número de propiedades que tiene el host en si. Esto se puede deber a que a mayor número de propiedades hablamos de una dedicación profesional y conlleva un aumento de precios en sus alojamientos en general. Otras variables como el número de reviews influencia también.</p>
<p>Vamos a crear una lista con las variables mas relevantes, para el siguiente modelo probaremos con las variables cuya suma de componentes sea mayor que 0:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>loadings_df <span class="ot">&lt;-</span> loadings_df_sorted <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Suma <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>seleccion_variables <span class="ot">&lt;-</span> <span class="fu">rownames</span>(loadings_df)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>seleccion_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(seleccion_variables, <span class="st">"price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tercer-modelo" class="level1">
<h1>Tercer modelo</h1>
<p>Vamos a hacer un modelo solo con las variables seleccionadas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En este caso solo vamos a aplicar las variables numéricas.</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>training_data3 <span class="ot">&lt;-</span> training_data <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seleccion_variables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(seleccion_variables)

  # Now:
  data %&gt;% select(all_of(seleccion_variables))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Las aplicamos al modelo</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>modelo3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> training_data3)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicamos test_data para esta prueba</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>test_data3 <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seleccion_variables)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecimos con el test_data</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>predicciones_modelo3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3, <span class="at">newdata =</span> test_data3)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadimos las predicciones una columna para comparar</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>test_data3 <span class="ot">&lt;-</span> test_data3 <span class="sc">%&gt;%</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicciones =</span> predicciones_modelo2)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular las métricas resultantes la variable price</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>metrics3 <span class="ot">&lt;-</span> test_data3 <span class="sc">%&gt;%</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> price, <span class="at">estimate =</span> predicciones)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegurarse de que 'predicciones' es un vector numérico sin nombres</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>test_data3<span class="sc">$</span>predicciones <span class="ot">&lt;-</span> <span class="fu">unname</span>(test_data3<span class="sc">$</span>predicciones)</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos el promedio de residuos y lo agregamos al data.frame de metrics</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>residuo3 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(modelo3))</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>residuo3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuo"</span>, <span class="st">"standard"</span>, residuo3)</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>metrics3 <span class="ot">&lt;-</span><span class="fu">rbind</span>(metrics3, residuo3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cuarto-y-quinto-modelo" class="level1">
<h1>Cuarto y quinto modelo</h1>
<p>Vamos a hacer dos modelos mas: Uno con una selección mas amplia de variables y otra con una selección mas corta, al final de todo comparemos todos los modelos y sacaremos conclusiones.</p>
<section id="cuarto-modelo" class="level2">
<h2 class="anchored" data-anchor-id="cuarto-modelo">Cuarto modelo</h2>
<p>Vamos a hacer una selección mas corta de variables filtrando por 0.10</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>loadings_df <span class="ot">&lt;-</span> loadings_df_sorted <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Suma <span class="sc">&gt;</span> <span class="fl">0.10</span>) </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>seleccion_variables <span class="ot">&lt;-</span> <span class="fu">rownames</span>(loadings_df)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>seleccion_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(seleccion_variables, <span class="st">"price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En este caso solo vamos a aplicar las variables numéricas.</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>training_data4 <span class="ot">&lt;-</span> training_data <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seleccion_variables)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Las aplicamos al modelo</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>modelo4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> training_data4)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicamos test_data para esta prueba</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>test_data4 <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seleccion_variables)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecimos con el test_data</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>predicciones_modelo4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo4, <span class="at">newdata =</span> test_data4)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadimos las predicciones una columna para comparar</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>test_data4 <span class="ot">&lt;-</span> test_data4 <span class="sc">%&gt;%</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicciones =</span> predicciones_modelo4)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular las métricas resultantes la variable price</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>metrics4 <span class="ot">&lt;-</span> test_data4 <span class="sc">%&gt;%</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> price, <span class="at">estimate =</span> predicciones)</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegurarse de que 'predicciones' es un vector numérico sin nombres</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>test_data4<span class="sc">$</span>predicciones <span class="ot">&lt;-</span> <span class="fu">unname</span>(test_data4<span class="sc">$</span>predicciones)</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos el promedio de residuos y lo agregamos al data.frame de metrics</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>residuo4 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(modelo4))</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>residuo4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuo"</span>, <span class="st">"standard"</span>, residuo4)</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>metrics4 <span class="ot">&lt;-</span><span class="fu">rbind</span>(metrics4, residuo4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="quinto-modelo" class="level2">
<h2 class="anchored" data-anchor-id="quinto-modelo">Quinto modelo</h2>
<p>Ahora haremos una selección mas larga filtrando por -0.10</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>loadings_df <span class="ot">&lt;-</span> loadings_df_sorted <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Suma <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">0.20</span>) </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>seleccion_variables <span class="ot">&lt;-</span> <span class="fu">rownames</span>(loadings_df)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>seleccion_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(seleccion_variables, <span class="st">"price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>training_data5 <span class="ot">&lt;-</span> training_data <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seleccion_variables)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Las aplicamos al modelo</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>modelo5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> ., <span class="at">data =</span> training_data5)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicamos test_data para esta prueba</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>test_data5 <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seleccion_variables)</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecimos con el test_data</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>predicciones_modelo5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo5, <span class="at">newdata =</span> test_data5)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadimos las predicciones una columna para comparar</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>test_data5 <span class="ot">&lt;-</span> test_data5 <span class="sc">%&gt;%</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicciones =</span> predicciones_modelo5)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular las métricas resultantes la variable price</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>metrics5 <span class="ot">&lt;-</span> test_data5 <span class="sc">%&gt;%</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> price, <span class="at">estimate =</span> predicciones)</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegurarse de que 'predicciones' es un vector numérico sin nombres</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>test_data5<span class="sc">$</span>predicciones <span class="ot">&lt;-</span> <span class="fu">unname</span>(test_data5<span class="sc">$</span>predicciones)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos el promedio de residuos y lo agregamos al data.frame de metrics</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>residuo5 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(modelo5))</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>residuo5 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuo"</span>, <span class="st">"standard"</span>, residuo5)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>metrics5 <span class="ot">&lt;-</span><span class="fu">rbind</span>(metrics5, residuo5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="comparativa-de-modelos" class="level1">
<h1>Comparativa de modelos</h1>
<p>Unficamos las métricas de los 5 modelos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(metrics1, metrics2, metrics3, metrics4, metrics5) <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.estimator)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>n_modelo <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">5</span>), <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>metricas<span class="sc">$</span>n_modelo <span class="ot">&lt;-</span> n_modelo</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> metricas <span class="sc">%&gt;%</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> .estimate)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metricas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  n_modelo rmse              rsq               mae               residuo        
     &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;          
1        1 92.2370396724672  0.395825071402194 55.1237606977542  -8.12008238426…
2        2 0.750713817706505 0.43642217949015  0.444070417275347 -1.05693231944…
3        3 0.750713817706505 0.43642217949015  0.444070417275347 -1.49963375051…
4        4 0.898035879986293 0.193568100662718 0.56628162831109  5.153100168797…
5        5 0.763072846484759 0.417753707452463 0.455242020155687 -4.17055279200…</code></pre>
</div>
</div>
<p>Vamos a comentar cada modelo basándonos en las métricas proporcionadas y luego seleccionaremos el mejor modelo.</p>
<p><strong>Modelo 1</strong></p>
<ul>
<li><p>El RMSE es muy alto, lo que indica que los errores de predicción son, en promedio, grandes.</p></li>
<li><p>Rsq es razonablemente alto, lo que sugiere que el modelo explica una buena cantidad de la varianza de los datos.</p></li>
<li><p>MAE es bastante alto, lo que indica errores significativos en la predicción.</p></li>
<li><p>El residuo es negativo y muy cercano a cero, lo que sugiere que en promedio, el modelo podría estar subestimando ligeramente las predicciones.</p></li>
</ul>
<p><strong>Modelo 2</strong></p>
<ul>
<li><p>El RMSE es considerablemente más bajo que el del Modelo 1, lo que indica una reducción significativa en los errores de predicción en comparación con el modelo que no utiliza normalización ni variables dummy.</p></li>
<li><p>El Rsq, es menor que el del Modelo 1. Un valor más bajo aquí sugiere que, aunque las predicciones son más precisas en términos de error cuadrático, la proporción de la varianza total que el modelo puede explicar ha disminuido.</p></li>
<li><p>El MAE reducido en el Modelo 2 refleja la mejora en la precisión de las predicciones después de la normalización y la inclusión de variables dummy. Como el MAE no da tanto peso a los errores más grandes como el</p></li>
</ul>
<p><strong>Modelo 3</strong></p>
<ul>
<li><p>El RMSE y el MAE son idénticos a los del Modelo 2, lo que indica que la selección de componentes no perjudicó la precisión de la predicción.</p></li>
<li><p>El Rsq permanece sin cambios respecto al Modelo 2, lo que sugiere que la cantidad de varianza explicada por el modelo es similar.</p></li>
<li><p>El residuo es negativo y muy pequeño, lo cual es consistente con el Modelo 2.</p></li>
</ul>
<p><strong>Modelo 4</strong></p>
<ul>
<li><p>Este modelo muestra un RMSE ligeramente más alto y un Rsq ligeramente más bajo que los Modelos 2 y 3, lo que indica que la eliminación de algunas variables mediante un umbral de carga más alto ha tenido un pequeño impacto negativo en el rendimiento del modelo.</p></li>
<li><p>El MAE es ligeramente más alto, lo que sugiere que las predicciones son menos precisas en promedio.</p></li>
<li><p>El residuo es positivo, lo que indica que este modelo podría estar sobreestimando ligeramente las predicciones en promedio.</p></li>
</ul>
<p><strong>Modelo 5</strong></p>
<ul>
<li><p>Este modelo tiene la menor RMSE y MAE de todos los modelos, lo que sugiere que tiene el mejor rendimiento en términos de precisión de la predicción.</p></li>
<li><p>El R² es también el más alto, indicando que este modelo explica la mayor parte de la varianza en los datos.</p></li>
<li><p>El residuo es negativo, pero muy cercano a cero, similar a los Modelos 2 y 3.</p></li>
</ul>
<section id="selección-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="selección-del-modelo">Selección del modelo</h2>
<p>El Modelo 5 parece ser el mejor en términos de todas las métricas proporcionadas. Tiene el RMSE más bajo, lo que indica que tiene el menor error de predicción promedio. También tiene el MAE más bajo, lo que sugiere que es consistente en su precisión a través de diferentes muestras. Además, el R² más alto indica que explica la mayor cantidad de varianza en la variable dependiente comparado con los otros modelos. Aunque el residuo es negativo, lo cual puede implicar una leve subestimación, está muy cerca de cero, lo que sugiere que en promedio, el sesgo del modelo es mínimo.</p>
<p>La inclusión de más variables (con cargas mayores de -0.10) en el Modelo 5 parece haber capturado mejor la complejidad subyacente de los datos, lo que ha resultado en un modelo más preciso.</p>
<p>Sin embargo, en la práctica, se recomendaría realizar una validación cruzada o pruebas en un conjunto de datos de prueba separado para evaluar mejor la capacidad del modelo para generalizar a nuevos datos antes de finalizar la selección del modelo.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>